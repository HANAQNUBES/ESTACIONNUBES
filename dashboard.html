<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HANAQ - UNALM Dashboard</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Outfit:wght@300;400;500;600&display=swap');
    
    * {
      font-family: 'Outfit', sans-serif;
    }
    
    .title-font {
      font-family: 'Orbitron', monospace;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .glass-card-dark {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .glow {
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
    }
    
    .animate-fade-in {
      animation: fadeIn 0.6s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-slide-in {
      animation: slideIn 0.8s ease-out;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .webcam-container {
      position: relative;
      overflow: hidden;
    }
    
    .webcam-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.3) 100%);
      pointer-events: none;
      z-index: 1;
    }
    
    .scan-line {
      position: absolute;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.8), transparent);
      animation: scan 3s linear infinite;
      z-index: 2;
    }
    
    @keyframes scan {
      0% { top: 0; }
      100% { top: 100%; }
    }
    
    .weather-icon {
      filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.6));
    }
    
    .metric-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(59, 130, 246, 0.3);
      transition: all 0.3s ease;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Iconos lucide simplificados como componentes
    const MapPin = () => <span>üìç</span>;
    const Camera = () => <span>üì∑</span>;
    const Clock = () => <span>‚è∞</span>;
    const Calendar = () => <span>üìÖ</span>;
    const Droplets = () => <span>üíß</span>;
    const Wind = () => <span>üí®</span>;
    const Eye = () => <span>üëÅÔ∏è</span>;
    const CloudRain = () => <span>üåßÔ∏è</span>;
    const AlertTriangle = () => <span>‚ö†Ô∏è</span>;
    const Wifi = () => <span>üì°</span>;
    const WifiOff = () => <span>üìµ</span>;
    const Thermometer = () => <span>üå°Ô∏è</span>;
    const Gauge = () => <span>üéõÔ∏è</span>;
    const Sun = () => <span>‚òÄÔ∏è</span>;
    const Leaf = () => <span>üçÉ</span>;

    const WeatherDashboard = () => {
      const [sensorData, setSensorData] = useState(null);
      const [raspberryStatus, setRaspberryStatus] = useState({ conectada: false });
      const [historial, setHistorial] = useState([]);
      const [hourlyForecast, setHourlyForecast] = useState([]);
      const [weeklyForecast, setWeeklyForecast] = useState([]);
      const [alerts, setAlerts] = useState([]);
      const [loading, setLoading] = useState(true);
      const [selectedWebcam] = useState(0);
      const [etaStatus, setEtaStatus] = useState({ procesando: false, imagen_path: null });
      const [etaImageUrl, setEtaImageUrl] = useState(null);
      const [wrfStatus, setWrfStatus] = useState({ procesando: false, imagen_path: null });
      const [wrfImageUrl, setWrfImageUrl] = useState(null);
      const [activeTab, setActiveTab] = useState('sensores'); // 'sensores', 'eta' o 'wrf'

      // Webcam del Campus UNALM - La Molina
      const webcams = [
        {
          name: "Campus UNALM",
          url: "https://images.webcams.travel/webcam/1366626800.jpg",
          location: "La Molina, Lima"
        }
      ];

      useEffect(() => {
        fetchSensorData();
        fetchWeatherForecast();
        fetchEtaStatus();
        fetchWrfStatus();
        // Actualizar datos de sensores cada 5 segundos
        const sensorInterval = setInterval(fetchSensorData, 5000);
        // Actualizar pron√≥stico cada 5 minutos
        const forecastInterval = setInterval(fetchWeatherForecast, 300000);
        // Actualizar estado ETA cada 10 segundos
        const etaInterval = setInterval(fetchEtaStatus, 10000);
        // Actualizar estado WRF cada 10 segundos
        const wrfInterval = setInterval(fetchWrfStatus, 10000);
        return () => {
          clearInterval(sensorInterval);
          clearInterval(forecastInterval);
          clearInterval(etaInterval);
          clearInterval(wrfInterval);
        };
      }, []);

      // Obtener estado del modelo ETA
      const fetchEtaStatus = async () => {
        try {
          const res = await fetch('/api/eta/estado');
          const data = await res.json();
          setEtaStatus(data);
          if (data.imagen_path) {
            setEtaImageUrl(`/api/eta/mapa?t=${Date.now()}`);
          }
        } catch (error) {
          console.error('Error fetching ETA status:', error);
        }
      };

      // Actualizar modelo ETA
      const actualizarModeloEta = async () => {
        try {
          await fetch('/api/eta/actualizar', { method: 'POST' });
          setEtaStatus({ ...etaStatus, procesando: true });
        } catch (error) {
          console.error('Error updating ETA model:', error);
        }
      };

      // Obtener estado del modelo WRF
      const fetchWrfStatus = async () => {
        try {
          const res = await fetch('/api/wrf/estado');
          const data = await res.json();
          setWrfStatus(data);
          if (data.imagen_path) {
            setWrfImageUrl(`/api/wrf/mapa?t=${Date.now()}`);
          }
        } catch (error) {
          console.error('Error fetching WRF status:', error);
        }
      };

      // Actualizar modelo WRF
      const actualizarModeloWrf = async () => {
        try {
          await fetch('/api/wrf/actualizar', { method: 'POST' });
          setWrfStatus({ ...wrfStatus, procesando: true });
        } catch (error) {
          console.error('Error updating WRF model:', error);
        }
      };

      // Obtener datos de sensores de la Raspberry Pi
      const fetchSensorData = async () => {
        try {
          // Obtener estado de conexi√≥n
          const statusRes = await fetch('/api/estado');
          const status = await statusRes.json();
          setRaspberryStatus({
            conectada: status.raspberry_conectada,
            ultimaActualizacion: status.ultima_actualizacion,
            segundosDesdeUltimo: status.segundos_desde_ultimo_dato
          });

          // Obtener datos de sensores
          const sensorRes = await fetch('/api/sensores');
          const data = await sensorRes.json();
          
          if (data.temperatura !== null) {
            setSensorData({
              temp: Math.round(data.temperatura),
              humidity: data.humedad,
              pressure: data.presion,
              windSpeed: data.viento_velocidad,
              windDirection: data.viento_direccion,
              precipitation: data.precipitacion,
              uvIndex: data.luz_uv,
              airQuality: data.calidad_aire,
              time: data.ultima_actualizacion ? new Date(data.ultima_actualizacion) : new Date()
            });
            setHistorial(data.historial || []);
          }
          
          // Generar alertas basadas en datos de sensores
          const newAlerts = [];
          if (data.viento_velocidad > 40) {
            newAlerts.push({
              type: 'warning',
              title: 'Vientos Fuertes',
              message: `Vientos de ${data.viento_velocidad} km/h detectados por sensores.`
            });
          }
          if (data.temperatura > 35) {
            newAlerts.push({
              type: 'warning',
              title: 'Temperatura Alta',
              message: `Temperatura de ${data.temperatura}¬∞C. Mant√©ngase hidratado.`
            });
          }
          if (data.luz_uv > 8) {
            newAlerts.push({
              type: 'warning',
              title: '√çndice UV Alto',
              message: `√çndice UV de ${data.luz_uv}. Use protecci√≥n solar.`
            });
          }
          if (data.calidad_aire > 100) {
            newAlerts.push({
              type: 'warning',
              title: 'Calidad de Aire',
              message: `AQI de ${data.calidad_aire}. Considere limitar actividades al aire libre.`
            });
          }
          setAlerts(newAlerts);
          
          setLoading(false);
        } catch (error) {
          console.error('Error fetching sensor data:', error);
          setLoading(false);
        }
      };

      // Obtener pron√≥stico de API externa (Open-Meteo)
      const fetchWeatherForecast = async () => {
        try {
          const lat = -12.0828;
          const lon = -76.9472;

          const response = await fetch(
            `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,precipitation_probability,weathercode,windspeed_10m&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max,windspeed_10m_max&timezone=America/Lima`
          );

          const data = await response.json();

          const hourly = [];
          for (let i = 0; i < 24; i++) {
            hourly.push({
              time: new Date(data.hourly.time[i]),
              temp: Math.round(data.hourly.temperature_2m[i]),
              precipitation: data.hourly.precipitation_probability[i],
              weatherCode: data.hourly.weathercode[i],
              windSpeed: Math.round(data.hourly.windspeed_10m[i])
            });
          }
          setHourlyForecast(hourly);

          const weekly = [];
          for (let i = 0; i < 7; i++) {
            weekly.push({
              date: new Date(data.daily.time[i]),
              maxTemp: Math.round(data.daily.temperature_2m_max[i]),
              minTemp: Math.round(data.daily.temperature_2m_min[i]),
              precipitation: data.daily.precipitation_probability_max[i],
              weatherCode: data.daily.weathercode[i],
              windSpeed: Math.round(data.daily.windspeed_10m_max[i])
            });
          }
          setWeeklyForecast(weekly);
        } catch (error) {
          console.error('Error fetching forecast:', error);
        }
      };

      const getWeatherEmoji = (code) => {
        if (code === 0) return '‚òÄÔ∏è';
        if (code === 1) return 'üå§Ô∏è';
        if (code === 2) return '‚õÖ';
        if (code === 3) return '‚òÅÔ∏è';
        if (code >= 45 && code <= 48) return 'üå´Ô∏è';
        if (code >= 51 && code <= 67) return 'üåßÔ∏è';
        if (code >= 71 && code <= 77) return 'üå®Ô∏è';
        if (code >= 80 && code <= 82) return '‚õàÔ∏è';
        if (code >= 85 && code <= 86) return 'üå®Ô∏è';
        if (code >= 95 && code <= 99) return '‚õàÔ∏è';
        return '‚òÅÔ∏è';
      };

      const getWeatherDescription = (code) => {
        if (code === 0) return 'Despejado';
        if (code <= 3) return 'Parcialmente nublado';
        if (code <= 48) return 'Nublado';
        if (code <= 67) return 'Lluvia';
        if (code >= 80) return 'Chubascos';
        return 'Variado';
      };

      const getWindDirection = (degrees) => {
        const directions = ['N', 'NE', 'E', 'SE', 'S', 'SO', 'O', 'NO'];
        return directions[Math.round(degrees / 45) % 8];
      };

      const formatTime = (date) => {
        return date.toLocaleTimeString('es-PE', { hour: '2-digit', minute: '2-digit' });
      };

      const formatDate = (date) => {
        return date.toLocaleDateString('es-PE', { weekday: 'short', day: 'numeric', month: 'short' });
      };

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
            <div className="text-white text-2xl font-light animate-pulse">Cargando datos meteorol√≥gicos...</div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-6 text-white">
          {/* Header */}
          <div className="max-w-7xl mx-auto mb-8 animate-fade-in">
            <div className="flex items-center justify-between mb-2">
              <h1 className="text-5xl font-black title-font bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                HANAQ - UNALM
              </h1>
              <div className="flex items-center gap-4">
                {/* Estado Raspberry Pi */}
                <div className={`flex items-center gap-2 glass-card px-4 py-2 rounded-full ${raspberryStatus.conectada ? 'border-green-500' : 'border-red-500'} border`}>
                  {raspberryStatus.conectada ? <Wifi /> : <WifiOff />}
                  <span className={`font-medium ${raspberryStatus.conectada ? 'text-green-400' : 'text-red-400'}`}>
                    {raspberryStatus.conectada ? 'Raspberry Pi Conectada' : 'Raspberry Pi Desconectada'}
                  </span>
                </div>
                <div className="flex items-center gap-2 glass-card px-4 py-2 rounded-full">
                  <MapPin />
                  <span className="font-medium">Campus UNALM, La Molina</span>
                </div>
              </div>
            </div>
            <p className="text-blue-200 text-sm font-light">
              {sensorData ? `Datos de sensores: ${sensorData.time?.toLocaleString('es-PE')}` : 'Esperando datos de Raspberry Pi...'}
            </p>
          </div>

          {/* Alertas */}
          {alerts.length > 0 && (
            <div className="max-w-7xl mx-auto mb-6 animate-slide-in">
              {alerts.map((alert, idx) => (
                <div key={idx} className="glass-card rounded-2xl p-4 mb-3 border-l-4 border-yellow-400">
                  <div className="flex items-start gap-3">
                    <AlertTriangle />
                    <div>
                      <h3 className="font-semibold text-lg text-yellow-400">{alert.title}</h3>
                      <p className="text-gray-200">{alert.message}</p>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}

          <div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            {/* Panel principal izquierdo */}
            <div className="lg:col-span-2 space-y-6">
              
              {/* Pesta√±as de navegaci√≥n */}
              <div className="flex gap-2 mb-4 flex-wrap">
                <button 
                  onClick={() => setActiveTab('sensores')}
                  className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                    activeTab === 'sensores' 
                      ? 'bg-blue-600 text-white glow' 
                      : 'glass-card-dark text-gray-300 hover:bg-white/10'
                  }`}
                >
                  üì° Sensores en Vivo
                </button>
                <button 
                  onClick={() => setActiveTab('eta')}
                  className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                    activeTab === 'eta' 
                      ? 'bg-green-600 text-white glow' 
                      : 'glass-card-dark text-gray-300 hover:bg-white/10'
                  }`}
                >
                  üåßÔ∏è Modelo ETA 8km
                </button>
                <button 
                  onClick={() => setActiveTab('wrf')}
                  className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                    activeTab === 'wrf' 
                      ? 'bg-purple-600 text-white glow' 
                      : 'glass-card-dark text-gray-300 hover:bg-white/10'
                  }`}
                >
                  üåÄ Modelo WRF 7km
                </button>
              </div>

              {/* Contenido de Sensores */}
              {activeTab === 'sensores' && (
                <>
                  {/* Vista del Cielo 360¬∞ con zonas horizontales */}
                  <div className="glass-card rounded-3xl p-6 animate-fade-in">
                    <div className="flex items-center justify-between mb-4">
                      <div className="flex items-center gap-3">
                        <Camera />
                        <h2 className="text-2xl font-bold title-font">CIELO 360¬∞ EN TIEMPO REAL</h2>
                      </div>
                      <div className="flex items-center gap-2 glass-card-dark px-3 py-1 rounded-full">
                        <div className="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                        <span className="text-xs font-medium">EN VIVO</span>
                      </div>
                    </div>
                    
                    {/* Imagen panor√°mica 360¬∞ con 4 zonas horizontales */}
                    <div className="relative rounded-2xl overflow-hidden mb-4">
                      <img 
                        src={`/api/cielo/imagen?t=${Date.now()}`}
                        alt="Vista del cielo 360¬∞"
                        className="w-full h-64 object-cover"
                        onError={(e) => {
                          e.target.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="800" height="200"%3E%3Crect fill="%23334155" width="800" height="200"/%3E%3Ctext fill="%23cbd5e1" font-family="Arial" font-size="20" x="50%25" y="50%25" text-anchor="middle" dominant-baseline="middle"%3EC√°mara no disponible%3C/text%3E%3C/svg%3E';
                        }}
                      />
                      
                      {/* L√≠neas divisorias verticales (3 l√≠neas = 4 zonas) */}
                      <div className="absolute top-0 left-[12.5%] w-0.5 h-full bg-yellow-400/70"></div>
                      <div className="absolute top-0 left-[37.5%] w-0.5 h-full bg-yellow-400/70"></div>
                      <div className="absolute top-0 left-[62.5%] w-0.5 h-full bg-yellow-400/70"></div>
                      <div className="absolute top-0 left-[87.5%] w-0.5 h-full bg-yellow-400/70"></div>
                      
                      {/* Etiquetas en los puntos cardinales exactos */}
                      {/* OESTE(0%) ‚Üí NORTE(25%) ‚Üí ESTE(50%) ‚Üí SUR(75%) ‚Üí OESTE(100%) */}
                      <div className="absolute top-2 left-[25%] transform -translate-x-1/2 bg-blue-600/80 px-3 py-1 rounded-lg border border-white/50">
                        <span className="text-white font-bold text-sm">‚¨ÜÔ∏è NORTE</span>
                      </div>
                      <div className="absolute top-2 left-[50%] transform -translate-x-1/2 bg-green-600/80 px-3 py-1 rounded-lg border border-white/50">
                        <span className="text-white font-bold text-sm">‚òÄÔ∏è ESTE</span>
                      </div>
                      <div className="absolute top-2 left-[75%] transform -translate-x-1/2 bg-red-600/80 px-3 py-1 rounded-lg border border-white/50">
                        <span className="text-white font-bold text-sm">‚¨áÔ∏è SUR</span>
                      </div>
                      
                      {/* Indicadores de extremos OESTE */}
                      <div className="absolute top-2 left-2 bg-purple-600/80 px-3 py-1 rounded-lg border border-white/50">
                        <span className="text-white font-bold text-sm">‚¨ÖÔ∏è OESTE</span>
                      </div>
                      <div className="absolute top-2 right-2 bg-purple-600/80 px-3 py-1 rounded-lg border border-white/50">
                        <span className="text-white font-bold text-sm">OESTE ‚û°Ô∏è</span>
                      </div>
                      
                      {/* Br√∫jula en centro inferior */}
                      <div className="absolute bottom-2 left-1/2 transform -translate-x-1/2 bg-black/60 p-2 rounded-full border border-yellow-400">
                        <span className="text-2xl">üß≠</span>
                      </div>
                    </div>

                    <div className="flex items-center justify-between">
                      <div className="text-sm font-medium text-blue-200">
                        üìç Estaci√≥n HANAQ - UNALM, La Molina
                      </div>
                      <div className="text-xs text-gray-400">
                        Imagen panor√°mica 360¬∞ ‚Ä¢ Actualizaci√≥n autom√°tica
                      </div>
                    </div>
                  </div>
                </>
              )}

              {/* Contenido del Modelo ETA */}
              {activeTab === 'eta' && (
                <div className="glass-card rounded-3xl p-6 animate-fade-in">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <CloudRain />
                      <h2 className="text-2xl font-bold title-font">MODELO ETA - PRECIPITACI√ìN</h2>
                    </div>
                    <button 
                      onClick={actualizarModeloEta}
                      disabled={etaStatus.procesando}
                      className={`px-4 py-2 rounded-xl font-semibold transition-all ${
                        etaStatus.procesando 
                          ? 'bg-gray-600 cursor-not-allowed' 
                          : 'bg-green-600 hover:bg-green-700'
                      }`}
                    >
                      {etaStatus.procesando ? '‚è≥ Procesando...' : 'üîÑ Actualizar Modelo'}
                    </button>
                  </div>
                  
                  <div className="mb-4">
                    <p className="text-sm text-blue-200 mb-2">
                      Datos del CPTEC/INPE - Modelo ETA 8km para Per√∫
                    </p>
                    {etaStatus.ultima_actualizacion && (
                      <p className="text-xs text-gray-400">
                        √öltima actualizaci√≥n: {new Date(etaStatus.ultima_actualizacion).toLocaleString('es-PE')}
                      </p>
                    )}
                    {etaStatus.error && (
                      <p className="text-xs text-red-400 mt-2">
                        Error: {etaStatus.error}
                      </p>
                    )}
                  </div>
                  
                  <div className="rounded-2xl overflow-hidden bg-slate-800">
                    {etaImageUrl ? (
                      <img 
                        src={etaImageUrl}
                        alt="Mapa de precipitaci√≥n ETA"
                        className="w-full h-auto"
                        onError={(e) => {
                          e.target.style.display = 'none';
                        }}
                      />
                    ) : (
                      <div className="h-96 flex items-center justify-center text-gray-400">
                        <div className="text-center">
                          <CloudRain />
                          <p className="mt-4">Haga clic en "Actualizar Modelo" para generar el mapa</p>
                          <p className="text-xs mt-2 text-gray-500">Primera ejecuci√≥n puede tardar varios minutos</p>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Contenido del Modelo WRF */}
              {activeTab === 'wrf' && (
                <div className="glass-card rounded-3xl p-6 animate-fade-in">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <span>üåÄ</span>
                      <h2 className="text-2xl font-bold title-font">MODELO WRF - PRECIPITACI√ìN</h2>
                    </div>
                    <button 
                      onClick={actualizarModeloWrf}
                      disabled={wrfStatus.procesando}
                      className={`px-4 py-2 rounded-xl font-semibold transition-all ${
                        wrfStatus.procesando 
                          ? 'bg-gray-600 cursor-not-allowed' 
                          : 'bg-purple-600 hover:bg-purple-700'
                      }`}
                    >
                      {wrfStatus.procesando ? '‚è≥ Procesando...' : 'üîÑ Actualizar Modelo'}
                    </button>
                  </div>
                  
                  <div className="mb-4">
                    <p className="text-sm text-purple-200 mb-2">
                      Datos del CPTEC/INPE - Modelo WRF 7km para Per√∫ (6 d√≠as de pron√≥stico)
                    </p>
                    {wrfStatus.ultima_actualizacion && (
                      <p className="text-xs text-gray-400">
                        √öltima actualizaci√≥n: {new Date(wrfStatus.ultima_actualizacion).toLocaleString('es-PE')}
                      </p>
                    )}
                    {wrfStatus.error && (
                      <p className="text-xs text-red-400 mt-2">
                        Error: {wrfStatus.error}
                      </p>
                    )}
                  </div>
                  
                  <div className="rounded-2xl overflow-hidden bg-slate-800">
                    {wrfImageUrl ? (
                      <img 
                        src={wrfImageUrl}
                        alt="Mapa de precipitaci√≥n WRF"
                        className="w-full h-auto"
                        onError={(e) => {
                          e.target.style.display = 'none';
                        }}
                      />
                    ) : (
                      <div className="h-96 flex items-center justify-center text-gray-400">
                        <div className="text-center">
                          <span className="text-6xl">üåÄ</span>
                          <p className="mt-4">Haga clic en "Actualizar Modelo" para generar el mapa</p>
                          <p className="text-xs mt-2 text-gray-500">Primera ejecuci√≥n puede tardar varios minutos (descarga ~150MB)</p>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Pron√≥stico por Horas */}
              <div className="glass-card rounded-3xl p-6 animate-fade-in">
                <div className="flex items-center gap-3 mb-4">
                  <Clock />
                  <h2 className="text-2xl font-bold title-font">PR√ìXIMAS 24 HORAS</h2>
                </div>
                
                <div className="overflow-x-auto">
                  <div className="flex gap-4 pb-2">
                    {hourlyForecast.slice(0, 12).map((hour, idx) => (
                      <div key={idx} className="glass-card-dark rounded-2xl p-4 min-w-[100px] text-center metric-card">
                        <div className="text-sm font-medium text-blue-300 mb-2">
                          {formatTime(hour.time)}
                        </div>
                        <div className="text-5xl mb-2">
                          {getWeatherEmoji(hour.weatherCode)}
                        </div>
                        <div className="text-2xl font-bold mb-1">{hour.temp}¬∞</div>
                        <div className="flex items-center justify-center gap-1 text-xs text-blue-300">
                          <Droplets />
                          <span>{hour.precipitation}%</span>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Pron√≥stico Semanal */}
              <div className="glass-card rounded-3xl p-6 animate-fade-in">
                <div className="flex items-center gap-3 mb-4">
                  <Calendar />
                  <h2 className="text-2xl font-bold title-font">PR√ìXIMOS 7 D√çAS</h2>
                </div>
                
                <div className="space-y-3">
                  {weeklyForecast.map((day, idx) => (
                    <div key={idx} className="glass-card-dark rounded-xl p-4 flex items-center justify-between hover:bg-white/10 transition-all">
                      <div className="flex items-center gap-4 flex-1">
                        <div className="w-16 font-semibold text-blue-300">
                          {formatDate(day.date)}
                        </div>
                        <div className="text-5xl">
                          {getWeatherEmoji(day.weatherCode)}
                        </div>
                        <div className="flex-1 text-sm text-gray-300">
                          {getWeatherDescription(day.weatherCode)}
                        </div>
                      </div>
                      <div className="flex items-center gap-6">
                        <div className="flex items-center gap-2">
                          <Droplets />
                          <span className="text-sm">{day.precipitation}%</span>
                        </div>
                        <div className="flex items-center gap-2">
                          <Wind />
                          <span className="text-sm">{day.windSpeed} km/h</span>
                        </div>
                        <div className="text-right min-w-[80px]">
                          <span className="text-xl font-bold text-orange-400">{day.maxTemp}¬∞</span>
                          <span className="text-gray-400 mx-1">/</span>
                          <span className="text-lg text-blue-300">{day.minTemp}¬∞</span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            {/* Panel derecho */}
            <div className="space-y-6">
              {/* Temperatura actual de sensores */}
              <div className="glass-card rounded-3xl p-8 animate-fade-in glow">
                <div className="flex items-center justify-between mb-6">
                  <h2 className="text-xl font-bold title-font text-cyan-400">SENSORES EN VIVO</h2>
                  <div className="flex items-center gap-2">
                    <div className={`w-3 h-3 rounded-full ${raspberryStatus.conectada ? 'bg-green-500 animate-pulse' : 'bg-red-500'}`}></div>
                    <Thermometer />
                  </div>
                </div>
                
                <div className="text-center mb-6">
                  <div className="text-8xl font-black title-font bg-gradient-to-b from-white to-blue-200 bg-clip-text text-transparent mb-2">
                    {sensorData?.temp ?? '--'}¬∞
                  </div>
                  <div className="text-xl text-blue-200 font-light mb-1">
                    Temperatura Real
                  </div>
                  <div className="text-sm text-gray-400">
                    Datos en tiempo real desde Raspberry Pi
                  </div>
                </div>
              </div>

              {/* M√©tricas de sensores */}
              <div className="grid grid-cols-2 gap-4">
                <div className="glass-card-dark rounded-2xl p-5 metric-card">
                  <div className="flex items-center gap-2 mb-3 text-blue-400">
                    <Droplets />
                    <span className="text-xs font-semibold uppercase tracking-wide">Humedad</span>
                  </div>
                  <div className="text-3xl font-bold">{sensorData?.humidity ?? '--'}%</div>
                </div>

                <div className="glass-card-dark rounded-2xl p-5 metric-card">
                  <div className="flex items-center gap-2 mb-3 text-cyan-400">
                    <Wind />
                    <span className="text-xs font-semibold uppercase tracking-wide">Viento</span>
                  </div>
                  <div className="text-3xl font-bold">{sensorData?.windSpeed ?? '--'}</div>
                  <div className="text-xs text-gray-400">km/h {sensorData?.windDirection ? getWindDirection(sensorData.windDirection) : ''}</div>
                </div>

                <div className="glass-card-dark rounded-2xl p-5 metric-card">
                  <div className="flex items-center gap-2 mb-3 text-purple-400">
                    <Gauge />
                    <span className="text-xs font-semibold uppercase tracking-wide">Presi√≥n</span>
                  </div>
                  <div className="text-3xl font-bold">{sensorData?.pressure ?? '--'}</div>
                  <div className="text-xs text-gray-400">hPa</div>
                </div>

                <div className="glass-card-dark rounded-2xl p-5 metric-card">
                  <div className="flex items-center gap-2 mb-3 text-orange-400">
                    <CloudRain />
                    <span className="text-xs font-semibold uppercase tracking-wide">Precipitaci√≥n</span>
                  </div>
                  <div className="text-3xl font-bold">{sensorData?.precipitation ?? '--'}</div>
                  <div className="text-xs text-gray-400">mm</div>
                </div>

                <div className="glass-card-dark rounded-2xl p-5 metric-card">
                  <div className="flex items-center gap-2 mb-3 text-yellow-400">
                    <Sun />
                    <span className="text-xs font-semibold uppercase tracking-wide">√çndice UV</span>
                  </div>
                  <div className="text-3xl font-bold">{sensorData?.uvIndex ?? '--'}</div>
                </div>

                <div className="glass-card-dark rounded-2xl p-5 metric-card">
                  <div className="flex items-center gap-2 mb-3 text-green-400">
                    <Leaf />
                    <span className="text-xs font-semibold uppercase tracking-wide">Calidad Aire</span>
                  </div>
                  <div className="text-3xl font-bold">{sensorData?.airQuality ?? '--'}</div>
                  <div className="text-xs text-gray-400">AQI</div>
                </div>
              </div>

              {/* Info adicional */}
              <div className="glass-card rounded-2xl p-6">
                <h3 className="font-bold text-lg mb-4 title-font text-cyan-400">INFORMACI√ìN</h3>
                <div className="space-y-3 text-sm">
                  <div className="flex justify-between">
                    <span className="text-gray-400">Sensores:</span>
                    <span className={`font-medium ${raspberryStatus.conectada ? 'text-green-400' : 'text-red-400'}`}>
                      {raspberryStatus.conectada ? 'Raspberry Pi' : 'Desconectado'}
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">Pron√≥stico:</span>
                    <span className="font-medium">Open-Meteo API</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">Actualizaci√≥n sensores:</span>
                    <span className="font-medium">Cada 5 segundos</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">Registros hist√≥ricos:</span>
                    <span className="font-medium">{historial.length}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<WeatherDashboard />, document.getElementById('root'));
  </script>
</body>
</html>